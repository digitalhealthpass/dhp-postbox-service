{
	"info": {
		"_postman_id": "cdf1c8f3-8ddc-49f2-892f-6ab8ca6e615f",
		"name": "dhp-postbox-service",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "health check",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - health\", function () {",
							"    postman.setNextRequest(null);",
							"    pm.response.to.have.status(200);",
							"    ",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/health",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"health"
					],
					"query": [
						{
							"key": "password",
							"value": "{{stlinkpass}}",
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "pobox standard user login",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"pm.globals.unset(\"HP_API_AUTH_TOKEN\");"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - login\", function () {",
							"    postman.setNextRequest(null);",
							"    pm.response.to.have.status(200);",
							"    pm.expect(pm.response.text()).to.include(\"token\");",
							"    postman.setNextRequest();",
							"",
							"    let tokenStr = pm.response.json();",
							"    ",
							"    pm.globals.set(\"HP_API_AUTH_TOKEN\", \"Bearer \" + tokenStr.access_token);",
							"});",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"{{STANDARD_USER_EMAIL}}\",\n    \"password\": \"{{STANDARD_USER_PASSWORD}}\"\n}"
				},
				"url": {
					"raw": "{{HEALTHPASS_API}}/users/login",
					"host": [
						"{{HEALTHPASS_API}}"
					],
					"path": [
						"users",
						"login"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create link",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Create link\", function () {",
							"    var jsonData = pm.response.json();",
							"",
							"    pm.response.to.have.status(201);",
							"",
							"    pm.environment.set(\"stlinkid\", jsonData.payload.id);",
							"    pm.environment.set(\"stlinkpass\", jsonData.payload.password);",
							"    console.log(\"stlinkid\", jsonData.payload.id);",
							"    console.log(\"stlinkpass\", jsonData.payload.password)",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman.",
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"no_expiration\": true,\r\n    \"owner\": \"{{STANDARD_USER_EMAIL}}\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/links",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"links"
					]
				}
			},
			"response": []
		},
		{
			"name": "Upload document 1",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Upload Document 1\", function () {",
							"    pm.response.to.have.status(201);",
							"",
							"    var jsonData = pm.response.json();",
							"",
							"    pm.environment.set(\"stdocid\", jsonData.payload.id);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"let uuid = require('uuid');\r",
							"\r",
							"// pre-populate expiration date,  not format\r",
							" //   \"expires_at\": \"2021-03-08T20:18:09Z\"      // correct\r",
							" //   \"expires_at\": \"2021-03-10T21:55:52.955Z\"  // inccorrect\r",
							"\r",
							"const days = 2;\r",
							"const expireTimeDate = new Date();\r",
							"console.log('current time = ', expireTimeDate.toISOString());\r",
							"\r",
							"expireTimeDate.setDate(expireTimeDate.getDate() + days);\r",
							"const expString = expireTimeDate.toISOString();\r",
							"let newExpString = expString.split(\".\")[0] + 'Z'\r",
							"\r",
							"console.log('expireTime = ', expireTimeDate.toISOString());\r",
							"console.log('newExpString = ', newExpString);\r",
							"pm.environment.set(\"expireTimeISO\", newExpString);\r",
							"pm.environment.set(\"x-hpass-txn-id\", uuid.v4())"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					},
					{
						"key": "x-hpass-txn-id",
						"value": "{{x-hpass-txn-id}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"content\": \"Mary had a little lamb, whose fleece was white as snow\",\n    \"password\": \"{{stlinkpass}}\",\n    \"link\": \"{{stlinkid}}\",\n    \"name\": \"first document\",\n    \"expires_at\": \"{{expireTimeISO}}\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/documents",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"documents"
					]
				}
			},
			"response": []
		},
		{
			"name": "Query links after create doc 1",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Query links after create doc 1\", function () {",
							"    pm.response.to.have.status(200);",
							"    pm.expect(",
							"        pm.response.json().payload.attachments.length",
							"    ).to.equal(1);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/links/{{stlinkid}}",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"links",
						"{{stlinkid}}"
					],
					"query": [
						{
							"key": "password",
							"value": "{{stlinkpass}}",
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Query attachments after create doc 1",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Query attachments after create doc 1\", function () {",
							"    pm.response.to.have.status(200);",
							"    pm.expect(",
							"        pm.response.json().payload.attachments.length",
							"    ).to.equal(1);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/links/{{stlinkid}}/attachments",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"links",
						"{{stlinkid}}",
						"attachments"
					],
					"query": [
						{
							"key": "password",
							"value": "{{stlinkpass}}",
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Upload document 2",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Upload Document 2\", function () {",
							"    pm.response.to.have.status(201);",
							"",
							"    var jsonData = pm.response.json();",
							"",
							"    pm.environment.set(\"stdocid\", jsonData.payload.id);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"let uuid = require('uuid');",
							"",
							"pm.environment.set(\"x-hpass-txn-id\", uuid.v4())"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					},
					{
						"key": "x-hpass-txn-id",
						"value": "{{x-hpass-txn-id}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"content\": \"Throughout human history, we have been dependent on machines to survive. Fate, it seems, is not without a sense of irony\",\n    \"password\": \"{{stlinkpass}}\",\n    \"link\": \"{{stlinkid}}\",\n    \"name\": \"second document\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/documents",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"documents"
					]
				}
			},
			"response": []
		},
		{
			"name": "Query links after create doc 2",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Query links after create doc 2\", function () {",
							"    pm.response.to.have.status(200);",
							"    pm.expect(",
							"        pm.response.json().payload.attachments.length",
							"    ).to.equal(2);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/links/{{stlinkid}}",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"links",
						"{{stlinkid}}"
					],
					"query": [
						{
							"key": "password",
							"value": "{{stlinkpass}}",
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Query attachments after create doc 2",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Query attachments after create doc 2\", function () {",
							"    pm.response.to.have.status(200);",
							"    pm.expect(",
							"        pm.response.json().payload.attachments.length",
							"    ).to.equal(2);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"let uuid = require('uuid');",
							"",
							"pm.environment.set(\"x-hpass-txn-id\", uuid.v4())"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					},
					{
						"key": "x-hpass-txn-id",
						"value": "{{x-hpass-txn-id}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/links/{{stlinkid}}/attachments",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"links",
						"{{stlinkid}}",
						"attachments"
					],
					"query": [
						{
							"key": "password",
							"value": "{{stlinkpass}}",
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Put update document 1",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Put update document 1\", function () {",
							"    pm.response.to.have.status(200);",
							"",
							"    var jsonData = pm.response.json();",
							"",
							"    pm.environment.set(\"stdocid\", jsonData.payload.id);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"let uuid = require('uuid');",
							"",
							"pm.environment.set(\"x-hpass-txn-id\", uuid.v4())"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					},
					{
						"key": "x-hpass-txn-id",
						"value": "{{x-hpass-txn-id}}",
						"type": "text"
					},
					{
						"key": "x-hpass-link-id",
						"value": "{{stlinkid}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"content\": \"updated content for link document\",\n    \"password\": \"{{stlinkpass}}\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/documents/{{stdocid}}",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"documents",
						"{{stdocid}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Query attachments after update doc",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Query attachments after update doc\", function () {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"let uuid = require('uuid');",
							"",
							"pm.environment.set(\"x-hpass-txn-id\", uuid.v4())"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					},
					{
						"key": "x-hpass-txn-id",
						"value": "{{x-hpass-txn-id}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/links/{{stlinkid}}/attachments",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"links",
						"{{stlinkid}}",
						"attachments"
					],
					"query": [
						{
							"key": "password",
							"value": "{{stlinkpass}}",
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Delete document",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Delete document\", function () {",
							"    pm.response.to.have.status(200);",
							"",
							"    var jsonData = pm.response.json();",
							"",
							"    pm.environment.set(\"stdocid\", jsonData.payload.id);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"let uuid = require('uuid');",
							"",
							"pm.environment.set(\"x-hpass-txn-id\", uuid.v4())"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					},
					{
						"key": "x-hpass-txn-id",
						"value": "{{x-hpass-txn-id}}",
						"type": "text"
					},
					{
						"key": "x-hpass-link-id",
						"value": "{{stlinkid}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/documents/{{stdocid}}",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"documents",
						"{{stdocid}}"
					],
					"query": [
						{
							"key": "password",
							"value": "{{stlinkpass}}",
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Query attachments after delte doc",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Query attachments after delte doc\", function () {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/links/{{stlinkid}}",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"links",
						"{{stlinkid}}"
					],
					"query": [
						{
							"key": "password",
							"value": "{{stlinkpass}}",
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Delete link",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"POBOX - Delete link\", function () {",
							"    var jsonData = pm.response.json();",
							"",
							"    pm.response.to.have.status(200);",
							"",
							"    pm.environment.set(\"stlinkid\", jsonData.payload.id);",
							"    pm.environment.set(\"stlinkpass\", jsonData.payload.password);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "x-postbox-access-token",
						"value": "{{stlinkpass}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "{{HP_API_AUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{POSTBOX-API}}/api/v1/postbox/links/{{stlinkid}}",
					"host": [
						"{{POSTBOX-API}}"
					],
					"path": [
						"api",
						"v1",
						"postbox",
						"links",
						"{{stlinkid}}"
					],
					"query": [
						{
							"key": "password",
							"value": "",
							"disabled": true
						}
					]
				}
			},
			"response": []
		}
	]
}